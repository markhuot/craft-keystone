{% do view.registerAssetBundle("markhuot\\keystone\\assetbundles\\KeystoneAssetBundle") %}

<style>
    ul ul .foo { display: block; }
    ul:not(:has(ul li)) .baz { display: none; }
</style>

{% macro layer(component, element, field) %}
    <ul class="k-relative" style="margin-left: 2rem;">
        <div class="k-absolute baz" style="top: 1.3rem; left: 0.5rem; bottom: 0; border-left: 1px solid rgba(96,125,159,.25);"></div>
        {% set lastOrder = 0 %}
        {% for child in component.getSlot() %}
            <li draggable="true" data-draggable="{{ child.id }}">
                <div class="k-flex k-justify-between" data-draggable-row>
                    <div style="position: relative;">
                        <div class="foo k-hidden" style="height:10px; width: 2rem; position: absolute; top: 0; left: calc(-1.5rem + 0px); border-radius: 0 0 0 10px; border-width: 0 0 1px 1px; border-color: rgba(96,125,159,.25); box-shadow: -2px 2px 0 white;"></div>
                        <button class="k-text-link" data-open-keystone-component-editor='{{ {id: child.id, elementId: child.elementId}|json_encode }}'>
                            <div style="background: white; display: inline-block;" data-draggable-handle>{{ child.getType().getIcon({class: 'k-w-1 k-inline'}) }}</div>
                            {{ child.getType().getName() }}
                        </button>
                        {{ hiddenInput('nodes[]', child.id ~ '@' ~ child.dateUpdated) }}
                    </div>
                    {# <button>â‹¯</button>  #}
                </div>
                {{ _self.layer(child, element, field) }}
            </li>
            {% set lastOrder = lastOrder + 1 %}
        {% endfor %}
        {% if component.getType().hasSlots() %}
            <li>
                <button data-open-keystone-component-selector='{{ {
                    elementId: element.id,
                    fieldId: field.id,
                    path: component.getChildPath(),
                    slot: null,
                    sortOrder: lastOrder
                }|json_encode }}' class="k-text-gray" style="background: white;">
                    <svg class="k-w-1 k-inline k-stroke-current" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 256 256"><path d="M128,26A102,102,0,1,0,230,128,102.12,102.12,0,0,0,128,26Zm0,192a90,90,0,1,1,90-90A90.1,90.1,0,0,1,128,218Zm46-90a6,6,0,0,1-6,6H134v34a6,6,0,0,1-12,0V134H88a6,6,0,0,1,0-12h34V88a6,6,0,0,1,12,0v34h34A6,6,0,0,1,174,128Z"></path></svg>
                    Add
                </button>
            </li>
        {% endif %}
    </ul>
{% endmacro %}

<div style="margin-left: -2rem;">
    {{ _self.layer(component, element, field) }}
</div>
